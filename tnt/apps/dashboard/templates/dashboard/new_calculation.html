{% extends "dashboard/page_template.html" %}

{% block content %}

<div id="new_calculation_basic_setup" class="new-calculation-step">

  <div class="jumbotron">
    <h1>Set up your system </h1>
    <p>Define some basic properties of the system you're simulating</p>
  </div>

  <div class="panel panel-default">
    <div class="panel-heading">
      <h3 class="panel-title">Basic system setup</h3>
    </div>

    <div class="panel-body">

      <div class="progress">
        <div class="progress-bar" role="progressbar" aria-valuenow="14" aria-valuemin="0" aria-valuemax="100" style="width: 14%;">
            Setup progress
        </div>
      </div>

      <h4>Calculation name</h4>
      <p>You can name your calculation, otherwise leave it blank and let us provide a random default for you. </p>
      <input class="form-control" id="calculation_name" type="text" class="" placeholder="Leave blank to generate random default" value="">

      <h4>System type</h4>
      <p>Choose the type of system you want to simulate.</p>

      <div class="row">
          <div class="col-md-4">
              <button type="button" data-system-type="spin" class="btn btn-system-type btn-default form-control active">Spin</button>
          </div>

          <div class="col-md-4">
              <button type="button" data-system-type="bosonic" class="btn btn-system-type btn-default form-control">Bosonic </button>
          </div>

          <div class="col-md-4">
              <button type="button" data-system-type="fermionic" class="btn btn-system-type btn-default form-control">Fermionic <span class="text-warning">(Coming soon)</span></button>
          </div>
      </div>

      <div id="system_type_extra_info_spins" style="display: block;" class="system_type_extra_info">

        <h4>Additional info</h4>
        <p>Choose the magnitude of the spin S, where 2S =  </p>


        <select id="system_type_extra_info_spins_choice" class="form-control">

            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>

        </select>

      </div>

      <div id="system_type_extra_info_bosons" style="display: none;" class="system_type_extra_info">

        <h4>Additional info</h4>
        <p>Choose the maximum number of bosons per site:</p>

        <select id="system_type_extra_info_bosons_choice" class="form-control">

            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>

        </select>

      </div>

      <div id="system_type_extra_info_fermions" style="display: none;" class="system_type_extra_info">

        <h4>Additional info</h4>
        <p>Are these fermions spinless, or spin one half?</p>

        <div id="fermions_spinless_choice" class="btn-group" data-toggle="buttons">
          <label class="btn btn-primary">
            <input type="radio" name="options" data-fermion-type="spinless">Spinless
          </label>
          <label class="btn btn-primary active">
            <input type="radio" name="options" data-fermion-type="spin_half" checked>Spin 1 / 2
          </label>
        </div>

      </div>

      <hr>

      <h4>System Size</h4>
      <p>How many sites in your system?</p>


        <form class="form-inline" role="form">
            <select id="system_size_choice" class="form-control">

            </select>
        </form>



      <!--<hr>-->

      <!--<h4>Number conservation</h4>-->
      <!--<p>Do you want to enforce number conservation?</p>-->

      <!--<div id="number_conservation_choice" class="btn-group" data-toggle="buttons">-->
        <!--<label class="btn btn-primary">-->
          <!--<input type="radio" name="options" data-number-conservation=1>Yes-->
        <!--</label>-->
        <!--<label class="btn btn-primary active">-->
          <!--<input type="radio" name="options" data-number-conservation=0 checked>No-->
        <!--</label>-->
      <!--</div>-->

      <hr>

      <h4>Simulation truncation parameters</h4>
      <p>Choose an upper bound for \( \chi \). This parameter controls the degree of quantum correlations the simulation captures. </p>


        <form class="form-inline" role="form">
            <select id="chi_choice" class="form-control">

            </select>
        </form>


      <hr>

      <div class="row new-calculation-step-navigation">  <!-- back next controls -->
          <div class="col-md-6">
              <button type="button" disabled="disabled" class="btn btn-default btn-back-step form-control btn-back-step">Back</button>
          </div>

          <div class="col-md-6">
              <button type="button" class="btn btn-success btn-next-step form-control ">Next</button>
          </div>
      </div>  <!-- End of back next controls -->

    </div>
  </div>

</div> <!-- End of div new_calculation_basic_setup -->

<!-- Ground state calculation specification -->
<div id="new_calculation_ground_state" class="new-calculation-step">

  <div class="panel panel-default">
    <div class="panel-heading">
      <h3 class="panel-title">Ground state calculation</h3>
    </div>

    <div class="progress">
      <div class="progress-bar" role="progressbar" aria-valuenow="42" aria-valuemin="0" aria-valuemax="100" style="width: 42%;">
          Setup progress
      </div>
    </div>

    <div class="panel-body">
      
      <h4>Ground state</h4>
      <p>Do you want to calculate the ground state of this Hamiltonian?</p>

      <div id="ground_state_calculation_choice" class="btn-group" data-toggle="buttons">
        <label class="btn btn-primary">
          <input type="radio" name="options" data-calculate-ground-state=1>Yes, calculate and save ground state
        </label>
        <label class="btn btn-primary active">
          <input type="radio" name="options" data-calculate-ground-state=0 checked>No
        </label>
      </div>

      <hr>

      <div id="ground_state_extra_info_specification" style="display: none;">

        <h5>Precision</h5>

        <p>Enter the precision with which you want to find the ground state. The number below is a convergence parameter - if the ground state energy on successive 'sweeps' do not differ by more than this fractional amount, the calculation is stopped. </p>

        <form class="form-horizontal" role="form">
          <div class="form-group">
            <label for="input_ground_state_precision_choice" class="col-sm-2 control-label">
                \[ \log{Precision} = \]
            </label>
            <div class="col-sm-10">

                <select id="input_ground_state_precision_choice" class="col-sm-4 form-control">

                </select>

            </div>
          </div>
        </form>

        <hr>
    
        <h5>Quantum number conservation</h5>
        <p>Is your calculation quantum number conserving?</p>

        <div id="ground_number_conservation_choice" class="btn-group" data-toggle="buttons">
          <label class="btn btn-primary">
            <input type="radio" name="options" data-number-conservation=1>Yes
          </label>
          <label class="btn btn-primary active">
            <input type="radio" name="options" data-number-conservation=0 checked>No
          </label>
        </div>

        <br>

        <div id="ground_state_quantum_number_info" style="display: none;">

            <p>
                Enter the quantum number. The possible values have been enumerated for you. 
            </p>

            <form class="form-inline" role="form">
                <select id="quantum_number_ground_state_choice" class="form-control">

                </select>
            </form>

        </div>

        <hr>

      </div> <!-- End of ground_state_extra_info_specification -->

      <div class="row new-calculation-step-navigation">
          <div class="col-md-6">
              <button type="button" class="btn btn-default btn-back-step form-control ">Back</button>
          </div>

          <div class="col-md-6">
              <button type="button" class="btn btn-success btn-next-step form-control ">Next</button>
          </div>
      </div>

    </div>
  </div>
</div> <!-- End of Ground state calculation specification -->

<div id="new_calculation_define_ground_hamiltonian" class="new-calculation-step">

  <div class="jumbotron">
    <h1>Define your ground state Hamiltonian </h1>
    <p>Build it up step by step by choosing from the predefined operators below.</p>
  </div>

  <div class="panel panel-default">
    <div class="panel-heading">
      <h3 class="panel-title">Available operators</h3>
    </div>

    <div class="panel-body">

      <div class="progress">
        <div class="progress-bar" role="progressbar" aria-valuenow="28" aria-valuemin="0" aria-valuemax="100" style="width: 28%;">
            Setup progress
        </div>
      </div>

      <p>Select from the following menu to add another Hamiltonian term, then customise it by choosing a functional form for its coefficients (defaults to constant across the system). 
      Each term will be used to form the Hamiltonian as 
      \[ 
      H = \sum_{j=0}^{L-1}\sum_o^{n_o}f_{o}(j)\hat{o}_{j} + \sum_{j=0}^{L-2}\sum_t^{n_t}f_{t}(j)\hat{t}_{j,j+1},
      \]
      where there are \( n_o \) onsite terms \( \hat{o} \), \( n_t \) two-site terms \( \hat{t} \), and where \( f_{o,t}(j) \) is the chosen spatial function for the onsite or two-site term \( \hat{o},\hat{t} \).
      </p>

      <div id="new_calculation_available_ground_hamiltonian_operators">

      </div>

      <hr>

      <h2 >Hamiltonian H = <span id="ground_hamiltonian_tex_str"></span></h2>

      <div id="no_ground_hamiltonian_terms_added_yet_warning" class="alert alert-info" role="alert">You haven't added any terms to the Hamiltonian yet!</div>

      <div id="ground_hamiltonian_terms_container">
      </div>

      <hr>

      <div class="row new-calculation-step-navigation">  <!-- back next controls -->
          <div class="col-md-6">
              <button type="button" class="btn btn-default btn-back-step btn-back-step form-control ">Back</button>
          </div>

          <div class="col-md-6">
              <button type="button" class="btn btn-success btn-next-step form-control ">Next</button>
          </div>
      </div>  <!-- End of back next controls -->

    </div>  <!-- End of panel body -->

  </div>  <!-- End of panel -->

</div>  <!-- End of div new_calculation_define_ground_hamiltonian-->

<!-- Time evolution calculation specification -->
<div id="new_calculation_time_evolution" class="new-calculation-step">

  <div class="panel panel-default">
    <div class="panel-heading">
      <h3 class="panel-title">Time evolution</h3>
    </div>

    <div class="progress">
      <div class="progress-bar" role="progressbar" aria-valuenow="56" aria-valuemin="0" aria-valuemax="100" style="width: 56%;">
          Setup progress
      </div>
    </div>

    <div class="panel-body">
      <h4>Time evolution</h4>

      <hr>

      <p>Do you want to calculate dynamical evolution of your system?</p>

      <div id="time_evolution_choice" class="btn-group" data-toggle="buttons">
        <label class="btn btn-primary active">
          <input type="radio" name="options" data-calculate-time-evolution=1 checked>Yes
        </label>
        <label class="btn btn-primary">
          <input type="radio" name="options" data-calculate-time-evolution=0>No
        </label>
      </div>

      <hr>

      <div id="time_evolution_time_step_specification">

          <div id="time_evolution_parameter_warning_msg" class="bg-warning text-warning" style="display:none;">
            <p>Please ensure your time step size is a real number, and your chosen number of time steps is between 1 and 2000. </p>
            <p>The number of expectation value evaluations must be no less than (the number of time steps) / 200, and no larger than the number of time steps. </p>
          </div>

        <form class="form-horizontal" role="form">
          <div class="form-group">
            <label for="input_num_time_steps" class="col-sm-3 control-label">Number of time steps</label>
            <div class="col-sm-9">
              <input type="number" class="form-control" id="input_num_time_steps" placeholder="100" value="100">
            </div>
          </div>
          <div class="form-group">
            <label for="input_time_step_size" class="col-sm-3 control-label">Time step size</label>
            <div class="col-sm-9">
              <input type="number" class="form-control" id="input_time_step_size" placeholder="0.01" value="0.01">
            </div>
          </div>
          <div class="form-group">
            <label for="input_num_expval_time_steps" class="col-sm-3 control-label">Number of time steps for expectation value evaluations</label>
            <div class="col-sm-9">
              <input type="number" class="form-control" id="input_num_expval_time_steps" placeholder="Leave blank to evaluate expectation values at every ten steps" value="">
            </div>
          </div>
        </form>

        <hr>

        <p>Enforce quantum number conservation on the dynamical evolution?</p>

        <div id="dynamical_number_conservation_choice" class="btn-group" data-toggle="buttons">
            <label class="btn btn-primary">
            <input type="radio" name="options" data-dynamical-number-conservation=1>Yes
            </label>
            <label class="btn btn-primary active">
            <input type="radio" name="options" data-dynamical-number-conservation=0 checked>No
            </label>
        </div>

      </div>

      <hr>

      <div class="row new-calculation-step-navigation">
          <div class="col-md-6">
              <button type="button" class="btn btn-default btn-back-step form-control ">Back</button>
          </div>

          <div class="col-md-6">
              <button type="button" class="btn btn-success btn-next-step form-control ">Next</button>
          </div>
      </div>

    </div> <!-- End of panel body -->

  </div> <!-- End of panel -->

</div> <!-- End of Time evolution calculation specification -->

<!-- Initial state specification -->
<div id="new_calculation_initial_state" class="new-calculation-step">
  <div class="panel panel-default">
    <div class="panel-heading">
      <h3 class="panel-title">Initial state</h3>
    </div>

    <div class="progress">
      <div class="progress-bar" role="progressbar" aria-valuenow="70" aria-valuemin="0" aria-valuemax="100" style="width: 70%;">
          Setup progress
      </div>
    </div>

    <div class="panel-body">

      <h4>Initial state - base state</h4>
      <p>Choose the initial state you want to evolve from. You can choose from the following given states, and optionally you can apply transformations by applying operators below. </p>

      <div id="new_calculation_available_initial_base_states">
      </div>


      <hr>

      <h4>Initial state - transformation</h4>

      <p>Now choose a transformation to tailor your initial state (optional).
      You can choose to apply the operator to the initial state as a <b>product</b> of terms or a <b>sum</b> of terms using the drop-down below.</p>

        <form class="form-inline" role="form">

        <div class="form-group">

            <label class="" for="initial_state_modifier_sum_or_product_choice">Sum or product</label>
            <select id="initial_state_modifier_sum_or_product_choice" class="form-control">

                <option value="sum">Sum</option>
                <option value="product">Product</option>

            </select>
        </div>
        <div class="checkbox">
            <label>
            <input type="checkbox" id="renormalise_after_initial_state_modifiers_choice">Renormalise wave function after applying modifiers
            </label>
        </div>
        </form>

      <div class="panel panel-default">

        <div class="panel-body">

            <p id="initial_state_modifier_explain_text_sum">If you choose a <b>sum</b> of terms, the chosen operators will be used to form the total site-wide operator as 
            \[ 
            \hat{O} = \sum_{j=0}^{L-1}\sum_o^{n_o}f_{o}(j)\hat{o}_{j},
            \]
            where there are \( n_o \) on-site terms \( \hat{o} \), and where \( f_{o}(j) \) is the chosen spatial function for the onsite term \( \hat{o} \).
            </p>
            
            <p id="initial_state_modifier_explain_text_product" style="display: none;">If you choose a <b>product</b> of terms, the chosen operators will be used to form the total site-wide operator as 
            \[ 
            \hat{O} = \prod_{j=0}^{L-1}\prod_o^{n_o}f_{o}(j)\hat{o}_{j},
            \]
            where there are \( n_o \) on-site terms \( \hat{o} \), and where \( f_{o}(j) \) is the chosen spatial function for the onsite term \( \hat{o} \). Note the operators will be applied to the base state in the order that they are chosen.
            </p>
      
        </div>

      </div>

      <div id="initial_state_modifier_operators_container">
      </div>

      <hr>

      <div id="initial_state_modifier_operators_terms">
      </div>

      <hr>

      <div class="row new-calculation-step-navigation">
          <div class="col-md-6">
              <button type="button" class="btn btn-default btn-back-step form-control ">Back</button>
          </div>

          <div class="col-md-6">
              <button type="button" class="btn btn-success btn-next-step form-control ">Next</button>
          </div>
      </div>
    </div>
  </div>
</div>
<!-- End of Time evolution specification -->

<div id="new_calculation_define_dynamic_hamiltonian" class="new-calculation-step">

  <div class="jumbotron">
    <h1>Define your dynamic Hamiltonian </h1>
    <p>This is the Hamiltonian controlling the system as it evolves from your chosen initial state. If you specified a ground state calculation, this Hamiltonian defaults to the Hamiltonian you chose to calculate the ground state. </p>
  </div>

  <div class="panel panel-default">
    <div class="panel-heading">
      <h3 class="panel-title">Available operators</h3>
    </div>

    <div class="panel-body">

      <div class="progress">
        <div class="progress-bar" role="progressbar" aria-valuenow="28" aria-valuemin="0" aria-valuemax="100" style="width: 28%;">
            Setup progress
        </div>
      </div>

      <p>Select from the following menu to add another Hamiltonian term, then customise it by choosing a functional form for its coefficients (defaults to constant across the system). 
      Each term will be used to form the Hamiltonian as 
      \[ 
      H = \sum_{j=0}^{L-1}\sum_o^{n_o}f_{o}(j)\hat{o}_{j} + \sum_{j=0}^{L-2}\sum_t^{n_t}f_{t}(j)\hat{t}_{j,j+1},
      \]
      where there are \( n_o \) onsite terms \( \hat{o} \), \( n_t \) two-site terms \( \hat{t} \), and where \( f_{o,t}(j) \) is the chosen spatial function for the onsite or two-site term \( \hat{o},\hat{t} \).
      </p>

      <div id="new_calculation_available_dynamic_hamiltonian_operators">

      </div>

      <hr>

      <h2>Hamiltonian H = <span id="dynamic_hamiltonian_tex_str"></span></h2>

      <div id="no_dynamic_hamiltonian_terms_added_yet_warning" class="alert alert-info" role="alert">You haven't added any terms to the Hamiltonian yet!</div>

      <div id="dynamic_hamiltonian_terms_container">
      </div>

      <hr>

      <div class="row new-calculation-step-navigation">  <!-- back next controls -->
          <div class="col-md-6">
              <button type="button" class="btn btn-default btn-back-step btn-back-step form-control ">Back</button>
          </div>

          <div class="col-md-6">
              <button type="button" class="btn btn-success btn-next-step form-control ">Next</button>
          </div>
      </div>  <!-- End of back next controls -->

    </div>  <!-- End of panel body -->

  </div>  <!-- End of panel -->

</div>  <!-- End of div new_calculation_define_dynamic_hamiltonian-->

<!-- Expectation value specification -->
<div id="new_calculation_expectation_operators" class="new-calculation-step">

  <div class="jumbotron">
    <h1>Expectation values</h1>
    <p>What do you want to calculate?</p>
  </div>

  <div class="panel panel-default">
    <div class="panel-heading">
      <h3 class="panel-title">Available expectation operators</h3>
    </div>

    <div class="panel-body">

      <div class="progress">
        <div class="progress-bar" role="progressbar" aria-valuenow="84" aria-valuemin="0" aria-valuemax="100" style="width: 84%;">
            Setup progress
        </div>
      </div>


      <div id="calculate_overlap_with_ground_state_choice_div">

          <h4>Do you want to calculate overlaps with the ground state?</h4>
          <div id="calculate_overlap_with_ground_state_choice" class="btn-group" data-toggle="buttons">

            <label class="btn btn-primary">
              <input type="radio" name="options" data-overlap-choice=1>Yes
            </label>
            <label class="btn btn-primary active">
              <input type="radio" name="options" data-overlap-choice=0 checked>No
            </label>
          </div>

          <hr>

      </div>

      <div id="no_expectation_operators_added_yet_warning" class="alert alert-warning" role="alert">You haven't specified any operators to calculate expectation values for yet!</div>

      <p>Select from the following menu to add another operator you wish to calculate expectation values for. </p>

      <h4>Single site expectation operators</h4>
      <div id="new_calculation_available_expectation_operators_single_site">

      </div>

      <hr>

      <h4>Two-site expectation operators</h4>
      <div id="new_calculation_available_expectation_operators_two_site">

      </div>

      <div class="row new-calculation-step-navigation">  <!-- back next controls -->
          <div class="col-md-6">
              <button type="button" class="btn btn-default btn-back-step form-control ">Back</button>
          </div>

          <div class="col-md-6">
              <button type="button" class="btn btn-success btn-next-step form-control ">Next</button>
          </div>
      </div>  <!-- End of back next controls -->

    </div>  <!-- End of panel body -->

  </div>  <!-- End of panel -->

</div> <!-- End of div new_calculation_expectation_operators -->

<!-- Confirm and submit the calculation -->
<div id="new_calculation_confirm" class="new-calculation-step">

  <div class="jumbotron">
    <h1>That's it!</h1>
    <p>If you're happy with this calculation, hit Save. You can then run it at your leisure. </p>
  </div>

  <div class="panel panel-default">
    <div class="panel-heading">
      <h3 class="panel-title">Confirmation</h3>
    </div>

    <div class="panel-body">

      <div class="progress">
        <div class="progress-bar" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%;">
            Setup progress
        </div>
      </div>

      <div class="row">
          <div class="col-md-6">
              <button type="button" id="cancel_calculation" class="btn btn-default form-control ">Cancel</button>
          </div>

          <div class="col-md-6">
              <button type="button" id="submit_calculation" class="btn btn-success btn-next-step form-control ">Save</button>
          </div>
      </div>

    </div>  <!-- End of panel body -->

  </div>  <!-- End of panel -->

</div> <!-- End of div new_calculation_confirm -->

{% endblock %}

{% block end_of_body_scripts %}
  <script>
    window.user = {};
    window.user.email = "{{user.email}}";
    window.user.id = "{{user.id}}";
    console.log("Stored logged in user details");

    tnt.initialise_new_calculation_basic_setup_step();  // Display the first screen of the setup process
    tnt.initialise_blank_calculation(); // Set up a 'blank' calculation which we will fill in sequentially

    $("#sidebar_new_calculation").addClass("active");

  </script>

{% endblock %}

{% block handlebars_scripts %}

  {% include "dashboard/handlebars_templates/hamiltonian_operator_template.html" %}

  {% include "dashboard/handlebars_templates/hamiltonian_term_template.html" %}

  {% include "dashboard/handlebars_templates/initial_base_states_template.html" %}  

  {% include "dashboard/handlebars_templates/spatial_dependence_template.html" %}  

  {% include "dashboard/handlebars_templates/expectation_operators_template.html" %}    
      
{% endblock %}
