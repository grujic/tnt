{% extends "dashboard/page_template.html" %}

{% block content %}

<div id="new_calculation_basic_setup" class="new-calculation-step">

  <div class="jumbotron">
    <h1>Set up your system </h1>
    <p>Define some basic properties of the system you're simulating</p>
  </div>

  <div class="panel panel-default">
    <div class="panel-heading">
      <h3 class="panel-title">Basic system setup</h3>
    </div>

    <div class="panel-body">

      <div class="progress">
        <div class="progress-bar" role="progressbar" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100" style="width: 20%;">
            Setup progress
        </div>
      </div>

      <h4>System type</h4>
      <p>Choose the type of system you want to simulate.</p>

      <div class="row">
          <div class="col-md-4">
              <button type="button" data-system-type="spin" class="btn btn-system-type btn-default form-control active">Spin</button>
          </div>

          <div class="col-md-4">
              <button type="button" data-system-type="bosonic" class="btn btn-system-type btn-default form-control">Bosonic </button>
          </div>

          <div class="col-md-4">
              <button type="button" data-system-type="fermionic" class="btn btn-system-type btn-default form-control" disabled="disabled">Fermionic <span class="text-warning">(Coming soon)</span></button>
          </div>
      </div>

      <div id="system_type_extra_info_spins" style="display: block;" class="system_type_extra_info">

        <h4>Additional info</h4>
        <p>Choose the magnitude of the spin S, where 2S =  </p>


        <select id="system_type_extra_info_spins_choice" class="form-control">

            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>

        </select>

      </div>

      <div id="system_type_extra_info_bosons" style="display: none;" class="system_type_extra_info">

        <h4>Additional info</h4>
        <p>Choose the maximum number of bosons per site:</p>

        <select id="system_type_extra_info_bosons_choice" class="form-control">

            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>

        </select>

      </div>

      <hr>

      <h4>System Size</h4>
      <p>How many sites in your system?</p>
      <input id="system_size" type="number" class="" placeholder="10" value="10">

      <!--<hr>-->

      <!--<h4>Number conservation</h4>-->
      <!--<p>Do you want to enforce number conservation?</p>-->

      <!--<div id="number_conservation_choice" class="btn-group" data-toggle="buttons">-->
        <!--<label class="btn btn-primary">-->
          <!--<input type="radio" name="options" data-number-conservation=1>Yes-->
        <!--</label>-->
        <!--<label class="btn btn-primary active">-->
          <!--<input type="radio" name="options" data-number-conservation=0 checked>No-->
        <!--</label>-->
      <!--</div>-->

      <hr>

      <h4>Simulation truncation parameters</h4>
      <p>Choose an upper bound for \( \chi \). This parameter controls the degree of quantum correlations the simulation captures. </p>

      <input id="chi_value" type="number" class="" placeholder="20" value="20">

      <hr>

      <div class="row new-calculation-step-navigation">  <!-- back next controls -->
          <div class="col-md-6">
              <button type="button" disabled="disabled" class="btn btn-default btn-back-step form-control btn-back-step">Back</button>
          </div>

          <div class="col-md-6">
              <button type="button" class="btn btn-success btn-next-step form-control ">Next</button>
          </div>
      </div>  <!-- End of back next controls -->

    </div>
  </div>

</div> <!-- End of div new_calculation_basic_setup -->

<div id="new_calculation_define_hamiltonian" class="new-calculation-step">

  <div class="jumbotron">
    <h1>Define your Hamiltonian </h1>
    <p>Build it up step by step by choosing from the predefined operators below. One site operators are summed over all sites. Two site operators are summed over all nearest neighbour pairs.</p>
  </div>

  <div class="panel panel-default">
    <div class="panel-heading">
      <h3 class="panel-title">Available operators</h3>
    </div>

    <div class="panel-body">

      <div class="progress">
        <div class="progress-bar" role="progressbar" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100" style="width: 40%;">
            Setup progress
        </div>
      </div>

      <p>Select from the following menu to add another Hamiltonian term. Then customise it by choosing a functional form for its coefficients (defaults to constant across the system). </p>

      <div id="new_calculation_available_hamiltonian_operators">

      </div>

      <!-- <div class="row">
          <div class="col-md-3">
              <button
               type="button" 
               class="btn btn-default form-control hamiltonian-operator-btn">
                <i>Description</i>
                \[ \sum_j \sigma_j^z \]
                <br>
              </button>
          </div>
          <div class="col-md-3">
              <button
               type="button" 
               class="btn btn-default form-control hamiltonian-operator-btn">
                <i>Description</i>
                \[ \sum_{j} \sigma_j^z \sigma_{j'}^z \]
                <br>
              </button>
          </div>
      </div> -->

      <hr>

      <h2>Hamiltonian H = </h2>

      <div id="no_hamiltonian_terms_added_yet_warning" class="alert alert-info" role="alert">You haven't added any terms to the Hamiltonian yet!</div>

      <div id="hamiltonian_terms_container">
      </div>

      <hr>

      <div class="row new-calculation-step-navigation">  <!-- back next controls -->
          <div class="col-md-6">
              <button type="button" class="btn btn-default btn-back-step btn-back-step form-control ">Back</button>
          </div>

          <div class="col-md-6">
              <button type="button" class="btn btn-success btn-next-step form-control ">Next</button>
          </div>
      </div>  <!-- End of back next controls -->

    </div>  <!-- End of panel body -->

  </div>  <!-- End of panel -->

</div>  <!-- End of div new_calculation_basic_setup -->

<!-- Ground state calculation specification -->
<div id="new_calculation_ground_state" class="new-calculation-step">

  <div class="panel panel-default">
    <div class="panel-heading">
      <h3 class="panel-title">Ground state calculation</h3>
    </div>

    <div class="progress">
      <div class="progress-bar" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 60%;">
          Setup progress
      </div>
    </div>

    <div class="panel-body">
      
      <h4>Ground state</h4>
      <p>Do you want to calculate the ground state of this Hamiltonian?</p>

      <div id="ground_state_calculation_choice" class="btn-group" data-toggle="buttons">
        <label class="btn btn-primary">
          <input type="radio" name="options" data-calculate-ground-state=1>Yes, calculate and save ground state
        </label>
        <label class="btn btn-primary active">
          <input type="radio" name="options" data-calculate-ground-state=0 checked>No
        </label>
      </div>

      <hr>

      <div id="ground_state_precision_specification" style="display: none;">
        
        <p>Enter the precision with which you want to find the ground state. The number below is a convergence parameter - if the ground state energy on successive 'sweeps' do not differ by more than this fractional amount, the calculation is stopped. </p>

        <form class="form-horizontal" role="form">
          <div class="form-group">
            <label for="input_ground_state_precision" class="col-sm-2 control-label">Precision = 10^-</label>
            <div class="col-sm-10">
              <input type="number" class="form-control" id="input_ground_state_precision" placeholder="4" value="4">
            </div>
          </div>
        </form>

      </div>


      <div class="row new-calculation-step-navigation">
          <div class="col-md-6">
              <button type="button" class="btn btn-default btn-back-step form-control ">Back</button>
          </div>

          <div class="col-md-6">
              <button type="button" class="btn btn-success btn-next-step form-control ">Next</button>
          </div>
      </div>

    </div>
  </div>
</div> <!-- End of Ground state calculation specification -->

<!-- Time evolution calculation specification -->
<div id="new_calculation_time_evolution" class="new-calculation-step">

  <div class="panel panel-default">
    <div class="panel-heading">
      <h3 class="panel-title">Time evolution</h3>
    </div>

    <div class="progress">
      <div class="progress-bar" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 60%;">
          Setup progress
      </div>
    </div>

    <div class="panel-body">
      <h4>Time evolution</h4>

      <hr>

      <p>Do you want to calculate dynamical evolution of your system?</p>

      <div id="time_evolution_choice" class="btn-group" data-toggle="buttons">
        <label class="btn btn-primary active">
          <input type="radio" name="options" data-calculate-time-evolution=1 checked>Yes
        </label>
        <label class="btn btn-primary">
          <input type="radio" name="options" data-calculate-time-evolution=0>No
        </label>
      </div>

      <hr>

      <div id="time_evolution_time_step_specification">
        
        <form class="form-horizontal" role="form">
          <div class="form-group">
            <label for="input_num_time_steps" class="col-sm-2 control-label">Number of time steps</label>
            <div class="col-sm-10">
              <input type="number" class="form-control" id="input_num_time_steps" placeholder="100" value="100">
            </div>
          </div>
          <div class="form-group">
            <label for="input_time_step_size" class="col-sm-2 control-label">Time step size</label>
            <div class="col-sm-10">
              <input type="number" class="form-control" id="input_time_step_size" placeholder="0.01" value="0.01">
            </div>
          </div>
        </form>

      </div>

      <hr>

      <div class="row new-calculation-step-navigation">
          <div class="col-md-6">
              <button type="button" class="btn btn-default btn-back-step form-control ">Back</button>
          </div>

          <div class="col-md-6">
              <button type="button" class="btn btn-success btn-next-step form-control ">Next</button>
          </div>
      </div>

    </div> <!-- End of panel body -->

  </div> <!-- End of panel -->

</div> <!-- End of Time evolution calculation specification -->

<!-- Initial state specification -->
<div id="new_calculation_initial_state" class="new-calculation-step">
  <div class="panel panel-default">
    <div class="panel-heading">
      <h3 class="panel-title">Initial state</h3>
    </div>

    <div class="progress">
      <div class="progress-bar" role="progressbar" aria-valuenow="70" aria-valuemin="0" aria-valuemax="100" style="width: 70%;">
          Setup progress
      </div>
    </div>

    <div class="panel-body">
      <h4>Initial state - base state</h4>
      <p>Choose the initial state you want to evolve from. You can choose from the following given states, and optionally you can apply transformations by applying operators below. </p>

      <div id="new_calculation_available_initial_base_states">
      </div>

      <hr>

      <h4>Initial state - transformation</h4>
      
      <p>Now choose a transformation to tailor your initial state (optional). </p>

      <div class="alert alert-warning" role="alert" id="no_initial_state_transformations_added_yet_warning">NOTE THESE MODIFIERS ARE NOT HOOKED UP TO THE UNDERLYING CODE BASE YET! COMING SOON... </div>

      <div id="initial_state_modifier_operators_container">
      </div>

      <hr>

      <div id="initial_state_modifier_operators_terms">
      </div>

      <hr>

      <div class="row new-calculation-step-navigation">
          <div class="col-md-6">
              <button type="button" class="btn btn-default btn-back-step form-control ">Back</button>
          </div>

          <div class="col-md-6">
              <button type="button" class="btn btn-success btn-next-step form-control ">Next</button>
          </div>
      </div>
    </div>
  </div>
</div>
<!-- End of Time evolution specification -->

<!-- Time evolution specification -->
<div id="new_calculation_expectation_operators" class="new-calculation-step">

  <div class="jumbotron">
    <h1>Expectation values</h1>
    <p>What do you want to calculate?</p>
  </div>

  <div class="panel panel-default">
    <div class="panel-heading">
      <h3 class="panel-title">Available expectation operators</h3>
    </div>

    <div class="panel-body">

      <div class="progress">
        <div class="progress-bar" role="progressbar" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100" style="width: 40%;">
            Setup progress
        </div>
      </div>

      <div class="alert alert-warning" role="alert">You haven't specified any operators to calculate expectation values for yet!</div>

      <p>Select from the following menu to add another operator you wish to calculate expectation values for. </p>

      <h4>Single site expectation operators</h4>
      <div id="new_calculation_available_expectation_operators_single_site">

      </div>

      <hr>

      <h4>Two-site expectation operators</h4>
      <div id="new_calculation_available_expectation_operators_two_site">

      </div>

      <div class="row new-calculation-step-navigation">  <!-- back next controls -->
          <div class="col-md-6">
              <button type="button" class="btn btn-default btn-back-step form-control ">Back</button>
          </div>

          <div class="col-md-6">
              <button type="button" class="btn btn-success btn-next-step form-control ">Next</button>
          </div>
      </div>  <!-- End of back next controls -->

    </div>  <!-- End of panel body -->

  </div>  <!-- End of panel -->

</div> <!-- End of div new_calculation_expectation_operators -->

<!-- Confirm and submit the calculation -->
<div id="new_calculation_confirm" class="new-calculation-step">

  <div class="jumbotron">
    <h1>That's it!</h1>
    <p>If you're happy with this calculation, hit Save. You can then run it at your leisure. </p>
  </div>

  <div class="panel panel-default">
    <div class="panel-heading">
      <h3 class="panel-title">Confirmation</h3>
    </div>

    <div class="panel-body">

      <div class="progress">
        <div class="progress-bar" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%;">
            Setup progress
        </div>
      </div>

      <div class="row">
          <div class="col-md-6">
              <button type="button" class="btn btn-default form-control ">Cancel</button>
          </div>

          <div class="col-md-6">
              <button type="button" id="submit_calculation" class="btn btn-success btn-next-step form-control ">Save</button>
          </div>
      </div>

    </div>  <!-- End of panel body -->

  </div>  <!-- End of panel -->

</div> <!-- End of div new_calculation_confirm -->

{% endblock %}

{% block end_of_body_scripts %}
  <script>
    window.user = {};
    window.user.email = "{{user.email}}";
    window.user.id = "{{user.id}}";
    console.log("Stored logged in user details");

    tnt.load_spatial_function_definitions();

    tnt.initialise_new_calculation_basic_setup_step();  // Display the first screen of the setup process
    tnt.initialise_blank_calculation(); // Set up a 'blank' calculation which we will fill in sequentially

    $("#sidebar_new_calculation").addClass("active");
    
  </script>

{% endblock %}

{% block handlebars_scripts %}

  {% include "dashboard/handlebars_templates/hamiltonian_operator_template.html" %}

  {% include "dashboard/handlebars_templates/hamiltonian_term_template.html" %}

  {% include "dashboard/handlebars_templates/initial_base_states_template.html" %}  

  {% include "dashboard/handlebars_templates/spatial_dependence_template.html" %}  

  {% include "dashboard/handlebars_templates/expectation_operators_template.html" %}    
      
{% endblock %}
