{% verbatim %}

<script>

    Handlebars.registerHelper("btn_disabled", function(status) {

        if ( (status == 'running') || (status == 'error') || (status == 'saved') ) {

            return '" disabled="disabled" ';

        } else {

            return '';

        }

    });

    Handlebars.registerHelper("timestamp_to_human_date", function(timestamp) {

        if ( (timestamp === null) || (timestamp == 0) || (timestamp == false) ) {

            return "None";

        } else {

            var date = new Date(timestamp*1000);

            return date.toLocaleString();

        }

    });

    Handlebars.registerHelper("render_log_output", function(status, log) {
        if (status == 'running') {
            return new Handlebars.SafeString("<code>" + log + "</code>");
        } else {
            return "";
        }
    }
    );

    Handlebars.registerHelper("render_action_button", function(status, calculation_id) {

        if (status == 'running') {

            var action_button_classes = 'btn-default download-calculation-button';
            var action_button_data_loading_text = 'Starting...';
            var action_button_text = 'Download MAT';

        } else if (status == 'saved') {

            var action_button_classes = 'btn-info run-calculation-button';
            var action_button_data_loading_text = 'Starting...';
            var action_button_text = 'Run';

        } else if (status == 'finished') {

            var action_button_classes = 'btn-default download-calculation-button';
            var action_button_data_loading_text = 'Starting...';
            var action_button_text = 'Download MAT';

        } else if (status == 'error') {

            var action_button_classes = 'btn-default download-calculation-button';
            var action_button_data_loading_text = 'Error!';
            var action_button_text = 'Error!';

        }

        var action_button_html = '<a role="button" class="btn form-control ' + action_button_classes + 
            '" data-loading-text="' + action_button_data_loading_text + 
            '" data-calculation-id="' + calculation_id;

        // Want some buttons to be disabled 
        if ( (status == 'error') || (status == 'running') ) {
            action_button_html = action_button_html + '" disabled="disabled" ';
        }

        action_button_html = action_button_html + '">' + action_button_text + '</a>';

        return new Handlebars.SafeString(action_button_html);

    });

</script>

<script id="user-calculations-template" type="text/x-handlebars-template"> 

    {{#calculations}}
        <div class="panel panel-default panel-calculation-info" data-calculation-id="{{meta_info.id}}">
          <div class="panel-heading">
              <h3 class="panel-title">

                <div class="input-group update_name_div">
                    <input type="text" class="form-control" placeholder="{{meta_info.name}}">
                    <span class="input-group-btn">
                        <button class="btn btn-default update_calculation_name_btn" type="button" data-calculation-id="{{meta_info.id}}">
                            Update name
                        </button>
                    </span>
                </div>

                  <!--<span class="pull-right">ID: {{meta_info.id}}</span>-->
              </h3>
          </div>

          <div class="panel-body">

            <div class="row">

            	<div class="col-md-6">

            		<p>Date created: {{timestamp_to_human_date meta_info.date_created}}</p>

            		<p>Date run: {{timestamp_to_human_date meta_info.date_run}}</p>

            		<p>Date finished: {{timestamp_to_human_date meta_info.finished}}</p>

            		<p>Status: {{meta_info.status}}</p>

            	</div>

            	<div class="col-md-6">
                    {{render_log_output meta_info.status meta_info.log}}
            	</div>

            </div>

            <hr>

            <div class="row">  
                <div class="col-xs-6 col-sm-3">
                    <a href="/calculation/explore/{{meta_info.id}}" {{btn_disabled meta_info.status}} role="button" class="btn btn-default form-control ">Explore</a>
                </div>

                <div class="col-xs-6 col-sm-3">
                    {{render_action_button meta_info.status meta_info.id}}
                </div>

                <div class="col-xs-6 col-sm-3">
                    <a href="/calculation/parameters/{{meta_info.id}}" role="button" class="btn btn-default form-control ">Parameters</a>
                </div>

                <div class="col-xs-6 col-sm-3">
                    <a role="button" class="btn btn-danger form-control btn-delete-calculation" data-calculation-id="{{meta_info.id}}">Delete</a>
                </div>

            </div>  

          </div> <!-- End of panel body -->

        </div>  <!-- End of panel -->

    {{/calculations}}

</script>

{% endverbatim %}
